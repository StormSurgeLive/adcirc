general:
    build_dir: work

dependencies:
    cache_directories: 
        - depend/hdf5_build
        - depend/netcdf_cc_build
        - depend/netcdf_fortran_build
        - depend/xdmf_build
    pre:
        - sudo apt-get update  -qq
        - sudo apt-get install -qq libopenmpi-dev libopenmpi-dbg bc cmake
        - sudo bash /home/ubuntu/adcirc-cg/circleci/installHdf5.sh
        - sudo bash /home/ubuntu/adcirc-cg/circleci/installnetCDF.sh
        - sudo bash /home/ubuntu/adcirc-cg/circleci/installnetCDF_fortran.sh
        - sudo bash /home/ubuntu/adcirc-cg/circleci/installXdmf.sh
        - git clone https://github.com/adcirc/adcirc-cg-testsuite.git /home/ubuntu/adcirc-cg-testsuite

test:
    override:
        - cp ../swan/macros.inc.gfortran ../swan/macros.inc
        - make compiler=circleci adcirc padcirc adcprep adccmp inflate hot2asc hstime aswip p15 build13 build12 libadc adcswan padcswan
        - make clean; make clobber
        - make compiler=circleci adcirc padcirc adcprep adccmp inflate hot2asc hstime aswip p15 build13 build12 libadc adcswan padcswan NETCDF=enable NETCDF4=enable NETCDF4_COMPRESSION=enable NETCDFHOME=/usr
        - make clean; make clobber
        - make compiler=circleci adcirc padcirc adcprep adccmp inflate hot2asc hstime aswip p15 build13 build12 libadc adcswan padcswan NETCDF=enable NETCDF4=enable NETCDF4_COMPRESSION=enable NETCDFHOME=/usr XDMF=enable XDMFHOME=/usr
        - cd /home/ubuntu/adcirc-cg-testsuite ; ./RunTests.sh /home/ubuntu/adcirc-cg/work:
            timeout: 7200
